
{%- comment -%}
Do not edit: snippet created by Variant Description Editor Application.
Do not delete this file unless you want to uninstall the application.
{%- endcomment -%}

{%- assign has_description = false -%}
{%- for variant in product.variants -%}
  {%- if variant.metafields['custom-descriptions']['variant-description-app'] != blank -%}
    {%- assign has_description = true -%}
    {% break %}
  {%- endif -%}
{%- endfor -%}

{%- assign selected_variant_description = product.selected_or_first_available_variant.metafields['custom-descriptions']['variant-description-app'] -%}

{%- if content_for_header contains 'variant-description-app' and has_description == true -%}
  {{ product.description }}

  <script data-variant-description-app="custom init">
    (function VariantDescriptionAppCustom(){
      'use strict';
      var initScript = document.querySelector('[data-variant-description-app="custom init"]');
      var parent = initScript.parentElement;

      appendStyle();
      appendConfig();

      {%- if selected_variant_description -%}
      var clone = parent.cloneNode(true);
      clone.removeAttribute('itemprop');
      clone.setAttribute('data-variant-description-app', 'variant description');
      clone.innerHTML = {{ selected_variant_description | json }};
      parent.parentElement.insertBefore(clone, parent);
      {%- endif -%}

      parent.setAttribute('data-variant-description-app', 'product description');
      parent.removeChild(initScript);

      function appendStyle(){
        var styleEl = document.createElement('style');
        styleEl.setAttribute('data-variant-description-app', 'style');
        styleEl.innerHTML = '[data-variant-description-app="variant description"] + [data-variant-description-app="product description"] {display:none!important}';
        document.body.appendChild(styleEl);
      }

      function appendConfig(){
        var scriptEl = document.createElement('script');
        scriptEl.setAttribute('type', 'application/json');
        scriptEl.setAttribute('data-variant-description-app', 'data');
        scriptEl.innerHTML = JSON.stringify({
          "{{ product.handle }}": {
            "product": {{ product.description | json }},
            "variants": {
            {%- for variant in product.variants -%}
              "{{ variant.id }}": {{ variant.metafields['custom-descriptions']['variant-description-app'] | json }}{%- unless forloop.last -%},{%- endunless -%}
            {%- endfor -%}
          }
        }});
        document.body.appendChild(scriptEl);
      }
    })();
  </script>

{%- else -%}
  {{ product.description }}
{%- endif -%}
